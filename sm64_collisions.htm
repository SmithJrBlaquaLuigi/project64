<canvas width="800" height="800" id="canvas"></canvas>


<script>

var ctx = document.getElementById('canvas').getContext('2d');
ctx.fillStyle = "#000"

var ajax = new XMLHttpRequest();
ajax.onreadystatechange = function()
{
	if(this.readyState == 4 && this.status == 200)
	{
		drawData(new DataView(this.response));
		setTimeout(doRequest, 100);
	}
}



function doRequest()
{
	ajax.open('GET', 'http://localhost/', true);
	ajax.responseType = 'arraybuffer';
	ajax.send();
}

doRequest();


function drawData(dv)
{	

	ctx.clearRect(0, 0, 800, 800);

	var i = 0;
	
	var curTri = dv.getUint32(0);
	i+=4;

	//alert(curTri);
	
	for(; i < dv.byteLength; i += 0x30)
	{
		var s = ""
		for(var j = 0; j < 0x30; j++)
		{
			var bt = dv.getUint8(i + j);
			bt = (bt < 0x10 ? '0':'') + bt.toString(16);
			s += bt + " ";
		}
		
		//console.log(s);
		
		var type = dv.getUint16(i + 0);
		
		//console.log(type)
		
		var xA = 400 + dv.getInt16(i + 10) / 30;
		var yA = 400 + dv.getInt16(i + 12) / 30;
		var zA = 400 + dv.getInt16(i + 14) / 30;
		var xB = 400 + dv.getInt16(i + 16) / 30;
		var yB = 400 + dv.getInt16(i + 18) / 30;
		var zB = 400 + dv.getInt16(i + 20) / 30;
		var xC = 400 + dv.getInt16(i + 22) / 30;
		var yC = 400 + dv.getInt16(i + 24) / 30;
		var zC = 400 + dv.getInt16(i + 26) / 30;
		
		//ctx.fillRect(xA, zA, 1, 1)
		//ctx.fillRect(xB, zC, 1, 1)
		//ctx.fillRect(xC, zC, 1, 1)
		
		var isCurTri = (i-4 == curTri);
		
		ctx.strokeStyle = isCurTri ? "#F00" : "#000";
		
		ctx.beginPath();
		ctx.moveTo(xA, zA);
		ctx.lineTo(xB, zB);
		ctx.lineTo(xC, zC);
		ctx.lineTo(xA, zA);
		ctx.stroke();
		
		var colors = {
			0x00: 'rgba(200, 200, 110, 0.5)',
			0x15: 'rgba(255, 0, 0, 0.5)',
			0x13: 'rgba(0, 255, 0, 0.5)',
			0x05: 'rgba(255, 255, 0, 0.5)',
			0x0e: 'rgba(0, 0, 255, 0.5)',
			0x0d: 'rgba(0, 255, 255, 0.5)',
			0x76: 'rgba(0, 255, 100, 0.5)', // wall?
			0x41: 'rgba(100, 255, 0, 0.5)',
			0x42: 'rgba(100, 255, 0, 0.5)',
			0x40: 'rgba(100, 255, 0, 0.5)',
			0x28: 'rgba(100, 255, 0, 0.5)',
			0x29: 'rgba(100, 255, 0, 0.5)',
			0x2A: 'rgba(60, 255, 50, 0.5)',
			
		}
		if(isCurTri)
		{
			ctx.fillStyle = '#FF0';
			ctx.fill();
		}
		else if(type in colors)
		{
			ctx.fillStyle = colors[type];
			ctx.fill();
		} else {
			alert(type.toString(16))
		}
		
	}
}


</script>